<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  th:replace="~{fragments/layout :: layout(~{::#conteudo}, 'Áreas de Interesse - Aprenda+')}"
>
  <body>
    <div id="conteudo">
      <div class="row justify-content-center">
        <div class="col-md-10">
          <div class="card shadow">
            <div class="card-body p-5">
              <h2 class="card-title text-center mb-4">
                <i class="fas fa-heart text-primary"></i> Selecione suas áreas
                de interesse
              </h2>
              <p class="text-center text-muted mb-4">
                Escolha até 3 áreas que mais te interessam e selecione seu nível
                de conhecimento em cada uma.
              </p>

              <div
                th:if="${erro}"
                class="alert alert-danger alert-dismissible fade show"
              >
                <span th:text="${erro}"></span>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="alert"
                ></button>
              </div>
              <div
                th:if="${sucesso}"
                class="alert alert-success alert-dismissible fade show"
              >
                <span th:text="${sucesso}"></span>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="alert"
                ></button>
              </div>

              <form
                th:action="@{/onboarding/areas-interesse}"
                method="post"
                id="areasForm"
              >
                <div class="row g-3">
                  <div
                    class="col-md-4 col-sm-6"
                    th:each="entry : ${todasAreas}"
                  >
                    <div
                      class="card h-100 area-card"
                      th:attr="data-area=${entry.key}"
                    >
                      <div class="card-body">
                        <div class="form-check mb-3">
                          <input
                            class="form-check-input area-checkbox"
                            type="checkbox"
                            th:id="${'area-' + entry.key}"
                            th:attr="data-area=${entry.key}"
                          />
                          <label
                            class="form-check-label w-100"
                            th:for="${'area-' + entry.key}"
                            style="cursor: pointer"
                          >
                            <div class="text-center mb-2">
                              <i class="fas fa-tag fa-2x text-primary"></i>
                            </div>
                            <strong
                              th:text="${entry.value}"
                              class="d-block text-center"
                            ></strong>
                          </label>
                        </div>

                        <!-- Seletor de Nível (oculto por padrão) -->
                        <div
                          th:id="${'nivel-' + entry.key}"
                          class="nivel-selector"
                          style="display: none"
                        >
                          <label
                            class="form-label small"
                            th:for="${'select-' + entry.key}"
                            >Nível:</label
                          >
                          <select
                            class="form-select form-select-sm nivel-select"
                            th:id="${'select-' + entry.key}"
                            th:attr="data-area=${entry.key}"
                          >
                            <option value="Iniciante">Iniciante</option>
                            <option value="Intermediário">Intermediário</option>
                            <option value="Avançado">Avançado</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="mt-4 text-center">
                  <p class="text-muted">
                    Selecionadas: <span id="counter">0</span> / 3
                  </p>
                  <button
                    type="submit"
                    class="btn btn-primary btn-lg"
                    id="continueBtn"
                    disabled
                  >
                    Continuar (<span id="counterBtn">0</span>)
                  </button>
                </div>

                <!-- Campos ocultos para enviar áreas e níveis -->
                <div id="hiddenFields" data-prefix="preferencias."></div>

                <input
                  type="hidden"
                  th:name="${_csrf.parameterName}"
                  th:value="${_csrf.token}"
                />
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <style>
      .area-checkbox {
        cursor: pointer;
      }
      .card {
        transition: all 0.3s;
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .area-card.selected {
        border: 2px solid #0d6efd;
        background-color: #e7f1ff;
      }
    </style>
  </body>
</html>
