<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  th:replace="~{fragments/layout :: layout(~{::#conteudo}, 'Detalhes do Curso - Aprenda+')}"
>
  <body>
    <div id="conteudo">
      <div class="dashboard-hero card mb-4">
        <div class="card-body p-4">
          <div class="d-flex flex-column flex-lg-row align-items-start gap-4">
            <a href="/cursos" class="btn btn-light text-dark">
              <i class="fas fa-arrow-left"></i> Voltar
            </a>
            <div class="d-flex gap-3 align-items-center flex-grow-1">
              <div class="display-1" th:text="${curso.icone}">üìö</div>
              <div>
                <div class="badge-level mb-2">
                  <span th:text="${curso.area}">√Årea</span> ¬∑
                  <span th:text="${curso.nivel}">N√≠vel</span>
                </div>
                <h1 class="fw-bold mb-2" th:text="${curso.titulo}">T√≠tulo</h1>
                <p class="mb-0" th:text="${curso.descricao}">desc</p>
              </div>
            </div>
            <div class="text-lg-end">
              <span class="badge bg-warning text-dark fs-6 px-3">
                <i class="fas fa-clock"></i>
                <span th:text="${curso.duracao}">40h</span>
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-3 mb-4">
        <div class="col-md-3">
          <div class="metric-card text-center">
            <div class="metric-icon bg-warning bg-opacity-25 text-warning mx-auto mb-2">
              <i class="fas fa-star"></i>
            </div>
            <p class="text-muted mb-1">Avalia√ß√£o m√©dia</p>
            <h3 class="mb-0" th:text="${curso.avaliacao}">4.5</h3>
          </div>
        </div>
        <div class="col-md-3">
          <div class="metric-card text-center">
            <div class="metric-icon bg-primary bg-opacity-10 text-primary mx-auto mb-2">
              <i class="fas fa-list-ol"></i>
            </div>
            <p class="text-muted mb-1">Total de aulas</p>
            <h3 class="mb-0" th:text="${curso.totalAulas}">12</h3>
          </div>
        </div>
        <div class="col-md-3">
          <div class="metric-card text-center">
            <div class="metric-icon bg-success bg-opacity-10 text-success mx-auto mb-2">
              <i class="fas fa-chalkboard-teacher"></i>
            </div>
            <p class="text-muted mb-1">Instrutor</p>
            <h5 class="mb-0" th:text="${curso.instrutor}">Instrutor</h5>
          </div>
        </div>
        <div class="col-md-3">
          <div class="metric-card text-center">
            <div class="metric-icon bg-info bg-opacity-10 text-info mx-auto mb-2">
              <i class="fas fa-clock"></i>
            </div>
            <p class="text-muted mb-1">Dura√ß√£o total</p>
            <h5 class="mb-0" th:text="${curso.duracao}">40h</h5>
            <div class="badge bg-warning text-dark mt-2 px-3 py-2">
              <i class="fas fa-coins"></i>
              At√© <strong th:text="${pontosCurso}">250</strong> pts
            </div>
          </div>
        </div>
      </div>

          <div class="card bg-light mb-4">
            <div class="card-body">
              <h5 class="card-title">Conte√∫do do Curso</h5>
              <p class="card-text" th:text="${curso.conteudo}">
                Conte√∫do detalhado do curso...
              </p>
            </div>
          </div>

          <div class="d-grid gap-2" sec:authorize="isAuthenticated()">
            <form
              th:action="@{/cursos/{id}/inscrever(id=${curso.id})}"
              method="post"
              th:if="${!inscrito}"
            >
              <button type="submit" class="btn btn-primary btn-lg w-100">
                <i class="fas fa-plus"></i> Inscrever-se no Curso
              </button>

              <input
                type="hidden"
                th:name="${_csrf.parameterName}"
                th:value="${_csrf.token}"
              />
            </form>
            <div th:if="${inscrito}" class="w-100">
              <div class="alert alert-success mb-3">
                <i class="fas fa-check-circle"></i> Voc√™ est√° inscrito neste
                curso!
                <span th:if="${usuarioCurso != null}">
                  Progresso:
                  <strong th:text="${usuarioCurso.progresso}">0</strong>%
                </span>
              </div>

              <!-- Se√ß√£o de Aulas -->
              <div class="card">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0">
                    <i class="fas fa-play-circle"></i> Aulas do Curso
                  </h5>
                </div>
                <div class="card-body">
                  <div class="list-group">
                    <div
                      class="list-group-item"
                      th:each="aula : ${aulas}"
                    >
                      <div
                        class="d-flex flex-column flex-md-row w-100 justify-content-between align-items-start align-items-md-center gap-3"
                      >
                        <div>
                          <h6 class="mb-1">
                            <i class="fas fa-video text-primary"></i>
                            Aula <span th:text="${aula.numero}">1</span>:
                            <span th:text="${aula.titulo}">T√≠tulo</span>
                          </h6>
                          <p class="mb-1 text-muted" th:text="${aula.resumo}">
                            Descri√ß√£o
                          </p>
                          <small class="text-muted">
                            <i class="fas fa-clock"></i>
                            <span th:text="${aula.duracao}">15 min</span>
                          </small>
                        </div>
                        <div class="text-md-end">
                          <span
                            class="badge mb-2"
                            th:classappend="${aula.concluida} ? 'bg-success' : 'bg-secondary'"
                          >
                            <i
                              class="fas"
                              th:classappend="${aula.concluida} ? ' fa-check' : ' fa-hourglass-half'"
                            ></i>
                            <span th:text="${aula.concluida ? 'Conclu√≠da' : 'Pendente'}"
                              >Status</span
                            >
                          </span>
                          <form
                            th:if="${!aula.concluida}"
                            th:action="@{/cursos/{id}/aulas/{numero}/concluir(id=${curso.id}, numero=${aula.numero})}"
                            method="post"
                            class="d-inline"
                          >
                            <input
                              type="hidden"
                              th:name="${_csrf.parameterName}"
                              th:value="${_csrf.token}"
                            />
                            <button class="btn btn-sm btn-outline-primary">
                              <i class="fas fa-check-circle"></i> Marcar como
                              conclu√≠da
                            </button>
                          </form>
                          <div
                            th:if="${aula.concluida}"
                            class="text-success fw-semibold"
                          >
                            ‚úÖ Pontos registrados
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="mt-3">
                    <div class="progress">
                      <div
                        class="progress-bar bg-success"
                        role="progressbar"
                        th:style="'width: ' + ${usuarioCurso != null ? usuarioCurso.progresso : 0} + '%'"
                        th:attr="aria-valuenow=${usuarioCurso != null ? usuarioCurso.progresso : 0}, aria-valuemin=0, aria-valuemax=100"
                      >
                        <span
                          th:text="${usuarioCurso != null ? usuarioCurso.progresso : 0}"
                          >0</span
                        >%
                      </div>
                    </div>
                    <small class="text-muted mt-2 d-block">
                      Continue assistindo as aulas para aumentar seu progresso!
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div sec:authorize="!isAuthenticated()" class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <a href="/login" class="alert-link">Fa√ßa login</a> para se inscrever
            neste curso.
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
